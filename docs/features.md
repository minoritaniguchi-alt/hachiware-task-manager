# 機能仕様書

> Koto Note — Features Document
> 最終更新: 2026-02-18（リンク機能・編集モーダル・詳細フィールド追加）

---

## 1. 解決する課題

### スプレッドシート管理の問題点

| 問題 | 詳細 | 本アプリでの解決策 |
|-----|------|----------------|
| 固定枠の圧迫 | カラム幅・行高が固定で情報が見づらい | カード型 UI で柔軟なレイアウト |
| Done タスクの埋没 | 完了済みが混在してアクティブタスクが見えにくい | Done を自動で「完了済み」へ格納 |
| ステータス視認性 | セルの色塗りが手間・見づらい | カラーバッジで一目でわかる |
| 定型業務の管理 | ルーチンと臨時が混在 | ダッシュボードで分離 |
| リロードで消える | ブラウザメモ等は揮発 | localStorage による永続化 |

---

## 2. 機能一覧

### 2-1. タスク管理（CRUD）

#### タスクデータ構造

```typescript
type Task = {
  id: string            // crypto.randomUUID()
  title: string         // タスクタイトル
  details: string       // 詳細説明（複数行可）
  memo: string          // 進捗メモ（黄色ボーダー表示）
  status: Status        // 'doing' | 'review' | 'pause' | 'waiting' | 'done'
  priority: Priority    // 'high' | 'mid' | 'low'
  dueDate: string       // ISO date string（任意）
  links: Link[]         // 関連リンク配列
  createdAt: string     // ISO timestamp
  completedAt: string | null  // Done 変更時に記録
}

type Link = {
  id: string    // crypto.randomUUID()
  url: string   // https://...
  title: string // リンクタイトル（任意）
}
```

#### タスク追加

- フォームにタイトルを入力して「追加」ボタン or Enter で追加
- フォーカス時に詳細入力欄が展開（アニメーション付き）
  - **詳細**: 複数行テキスト（任意）
  - **進捗メモ**: フリーテキスト（任意、黄色枠スタイルで表示）
  - **ステータス**: Doing / Review / Pause / Waiting / Done から選択（デフォルト: Doing）
  - **優先度**: 高 / 中 / 低（デフォルト: 中）
  - **期限日**: date ピッカーで選択（任意）
  - **関連リンク**: URL + タイトルのペアを複数追加可能
- 追加成功時にトースト通知を表示

#### タスク編集（編集モーダル）

- 各タスク行をホバーするとペンシルアイコンが表示
- クリックで **TaskEditModal**（フルスクリーン固定オーバーレイ）が開く
- 編集可能なフィールド：タイトル・詳細・進捗メモ・ステータス・優先度・期限日・関連リンク
- 「保存」でタスク更新、「キャンセル」で変更破棄
- 保存成功時にトースト「保存しました」を表示

#### ステータス変更（バッジドロップダウン）

- StatusBadge をクリックするとドロップダウンが開く
- `position: fixed` + `getBoundingClientRect()` で位置計算 → `overflow:hidden` の親要素に一切クリップされない
- 5種類のステータスから選択可能
- Done に変更すると `completedAt` が記録され、自動的にアーカイブへ移動

#### タスク削除

- 各タスク行をホバーするとゴミ箱アイコンが表示
- クリックで即削除（確認ダイアログなし）

---

### 2-2. 関連リンク機能

タスクに複数の URL を紐づけて管理できる。

#### 追加フォームでの入力

- 「+ リンクを追加」ボタンで入力行を展開
- URL（必須）とリンクタイトル（任意）を入力
- 「+」ボタンでリンクを追加、「×」で行を削除

#### タスク行での表示

- タイトル下にリンクを縦リスト表示
- チェーンアイコン + リンクタイトル（タイトル未設定時は URL を短縮表示）
- クリックで新しいタブで開く（`target="_blank" rel="noopener noreferrer"`）

#### 編集モーダルでの管理

- 既存リンクの URL・タイトルを編集可能
- 「×」ボタンで個別削除
- 新規リンクを追加可能

---

### 2-3. タスク自動整理アルゴリズム

#### Done タスクの自動アーカイブ

```
ステータスを Done に変更
    │
    ▼
completedAt = new Date().toISOString() をセット
    │
    ▼
tasks 配列を再計算（React レンダリング）
    │
    ▼
activeTasks = tasks.filter(t => t.status !== 'done')
doneTasks   = tasks.filter(t => t.status === 'done')
              .sort((a, b) => completedAt の新しい順)
    │
    ▼
activeTasks → 「やること」セクションに表示
doneTasks   → 「完了済みのタスク」に折りたたまれて表示
```

#### アーカイブからの復元

- Done タスクをホバーすると「↩ リストに戻す」アイコンが表示
- クリックで `status: 'doing'`, `completedAt: null` に戻す
- トースト「リストに戻しました」を表示

---

### 2-4. ダッシュボード機能

3つのカテゴリカードで定型・予定業務を管理する。

| カード | ID | 用途 | アイコン |
|-------|-----|------|--------|
| ルーチン業務 | `routine` | 毎日・毎週の定型作業チェックリスト | 🍜 |
| 臨時対応 | `adhoc` | 突発的に発生した依頼・対応メモ | 📷 |
| 予定 | `schedule` | 会議・締め切りなどのスケジュール | 🎸 |

- 各カードにテキスト入力 + 追加ボタン
- タイトル行クリックで折りたたみ可能（条件レンダリングで実装）
- アイテムごとにホバーで削除ボタン表示
- ダッシュボード全体も折りたたみ可能（「ダッシュボード」見出しをクリック）
- 猫耳モチーフ（丸みを帯びた2つ三角形SVG）をカード毎に絶対配置

---

### 2-5. フィルタリング機能

タスクリスト上部のフィルターボタンで表示ステータスを絞り込む。

- **すべて**: 全アクティブタスクを表示
- **Doing / Review / Pause / Waiting**: 各ステータスのタスクのみ表示
- フィルターボタンには件数バッジを表示

---

### 2-6. 統計表示

ヘッダーに現在の状況を表示（SM サイズ以上）：

- **進行中 N件**: status が `doing` のタスク数
- **今日 N件完了**: `completedAt` が今日の日付の Done タスク数

---

### 2-7. データ永続化

```javascript
// 保存
localStorage.setItem('hachiware-tasks-v1', JSON.stringify(tasks))
localStorage.setItem('hachiware-dashboard-v1', JSON.stringify(dashboard))

// 読み込み（初期化時）
const saved = localStorage.getItem('hachiware-tasks-v1')
return saved ? JSON.parse(saved) : []
```

- React の `useEffect` が `tasks` / `dashboard` の変更を検知して自動保存
- 初期化は `useState` のイニシャライザ関数で行い、パースエラー時は空配列にフォールバック
- 旧スキーマ（`links` フィールドなし）との後方互換: 読み込み時にデフォルト値を補完

---

### 2-8. トースト通知

| トリガー | メッセージ |
|---------|----------|
| タスク追加 | 「追加しました」「いってみよう！」「ファイト！」 |
| Done に変更 | 「完了！」「すごい！」「やったね！」「完璧！」「えらい！」 |
| アーカイブから復元 | 「リストに戻しました」 |
| タスク編集保存 | 「保存しました」 |

- ランダムで選択して表示（Done メッセージのみ）
- 2.5秒後に自動消去

---

## 3. 実装対象外（意図的な除外）

| 機能 | 除外理由 |
|-----|---------|
| ドラッグ&ドロップ並び替え | 初版スコープ外（今後の拡張で `@dnd-kit` 導入予定） |
| 検索機能 | タスク数が少ない間は不要と判断 |
| 複数ユーザー対応 | localStorage のみのため単一ユーザー前提 |
| タグ・カテゴリ | 今後の拡張対象 |
